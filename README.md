# üå∏ Anime Music Garden

A beautiful full-stack web application where users can log their daily interactions with anime and its music, visualizing their journey as a growing digital garden. Each check-in (anime episode, opening/ending theme, or insert song) appears as a flower in the user's personal garden, with colors and sizes reflecting ratings and emotional responses.

## üéØ Features

- **User Authentication**: Secure JWT-based authentication system
- **Digital Garden Visualization**: Interactive garden where each check-in blooms as a unique flower
- **Check-in Management**: Log anime episodes, opening/ending themes, and insert songs
- **Real-time Updates**: Socket.io integration for live garden updates
- **Statistics Dashboard**: Track streaks, ratings, and check-in history
- **Beautiful UI**: Modern, responsive design with smooth animations

## üõ†Ô∏è Tech Stack

### Backend
- **Node.js** with Express.js
- **MongoDB** with Mongoose
- **JWT** for authentication
- **Socket.io** for real-time updates
- **Jest** for testing

### Frontend
- **React** with Vite
- **React Router** for navigation
- **Axios** for API calls
- **Socket.io Client** for real-time features
- **CSS3** with custom properties

## üìã Prerequisites

- Node.js (v16 or higher)
- MongoDB (local installation)
- npm or yarn

## üöÄ Getting Started

### 1. Clone the Repository

```bash
git clone <repository-url>
cd Anime-Music-Garden
```

### 2. Install Dependencies

**Backend (root directory):**
```bash
npm install
```

**Frontend (client directory):**
```bash
cd client
npm install
```

### 3. Environment Variables

Create a `.env` file in the root directory:

```env
# Server Configuration
PORT=5000
NODE_ENV=development

# MongoDB (local)
MONGODB_URI=mongodb://127.0.0.1:27017/anime-music-garden

# JWT Secret
JWT_SECRET=your-super-secret-jwt-key-change-this-in-production

# Client URL (for CORS and Socket.io)
CLIENT_URL=http://localhost:3000
```

**Important**: 
- Change `JWT_SECRET` to a secure random string in production!

### 4. Start MongoDB

Start MongoDB locally:
```bash
# On macOS with Homebrew
brew services start mongodb-community

# On Linux
sudo systemctl start mongod

# On Windows
# Start MongoDB service from Services panel
```

### 5. Run the Application

**Development Mode:**

You can run backend and frontend independently in separate terminals:

**Terminal 1 - Backend (root directory):**
```bash
npm start
# or for development with auto-reload:
npm run dev
```

**Terminal 2 - Frontend (client directory):**
```bash
cd client
npm start
# or for development:
npm run dev
```

The application will be available at:
- Frontend: http://localhost:3000
- Backend API: http://localhost:5000

**Production Mode:**

Build the frontend:
```bash
cd client
npm run build
```

Start the production server (root directory):
```bash
npm start
```

The server will serve both the API and the built frontend from `client/dist`. Access the application at `http://localhost:5000`.

## üìÅ Project Structure

```
Anime-Music-Garden/
‚îú‚îÄ‚îÄ server/                    # Backend (Express + MongoDB)
‚îÇ   ‚îú‚îÄ‚îÄ server.js              # Main server file
‚îÇ   ‚îú‚îÄ‚îÄ controllers/           # Request handlers
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ authControllers.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ checkInControllers.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ userControllers.js
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ _tests_/           # Controller tests
‚îÇ   ‚îú‚îÄ‚îÄ services/              # Business logic
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ authService.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ checkInService.js
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ userService.js
‚îÇ   ‚îú‚îÄ‚îÄ routes/                # API routes
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ users.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ checkins.js
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ anime.js
‚îÇ   ‚îú‚îÄ‚îÄ models/                # MongoDB models
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ User.js
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ CheckIn.js
‚îÇ   ‚îú‚îÄ‚îÄ middleware/            # Express middleware
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ auth.js
‚îÇ   ‚îú‚îÄ‚îÄ db/                    # Database connection
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ db.js
‚îÇ   ‚îî‚îÄ‚îÄ test-resources/        # Test files
‚îÇ       ‚îî‚îÄ‚îÄ AnimeMusicGarden.pm_collection.json
‚îú‚îÄ‚îÄ client/                    # Frontend (React + Vite)
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/        # React components
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pages/             # Page components
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ contexts/          # React contexts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ services/          # API services
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ App.jsx            # Main app component
‚îÇ   ‚îú‚îÄ‚îÄ dist/                  # Production build (generated by npm run build)
‚îÇ   ‚îú‚îÄ‚îÄ index.html
‚îÇ   ‚îú‚îÄ‚îÄ vite.config.js
‚îÇ   ‚îî‚îÄ‚îÄ package.json
‚îú‚îÄ‚îÄ jest.config.js             # Jest configuration
‚îú‚îÄ‚îÄ package.json               # Backend dependencies
‚îî‚îÄ‚îÄ README.md
```

## üß™ Testing

### Run Backend Tests

```bash
npm test
```

### Run Tests with Coverage

```bash
npm test -- --coverage
```

### Postman Collection

Import `server/test-resources/AnimeMusicGarden.pm_collection.json` into Postman to test the API endpoints. The collection includes:
- Authentication endpoints (register)
- User profile endpoints
- Check-in CRUD operations
- Health check endpoint

**Note**: After registering, the collection automatically saves the auth token for subsequent requests.

## üåê API Endpoints

### Authentication
- `POST /api/auth/register` - Register a new user (returns access + refresh tokens)
- `POST /api/auth/login` - Login user (returns access + refresh tokens)
- `POST /api/auth/refresh` - Refresh access token using refresh token
- `POST /api/auth/logout` - Logout and invalidate refresh token (protected)
- `GET /api/auth/me` - Get current user (protected)

### Users
- `GET /api/users/profile` - Get user profile with stats (protected)
- `PUT /api/users/profile` - Update user profile (protected)
- `GET /api/users/admin/stats` - Get admin statistics (admin only)
- `GET /api/users/admin/users` - Get all users (admin only)

### Check-ins
- `POST /api/checkins` - Create a new check-in (protected)
- `GET /api/checkins` - Get all check-ins for user (protected)
- `GET /api/checkins/:id` - Get specific check-in (protected)
- `PUT /api/checkins/:id` - Update check-in (protected)
- `DELETE /api/checkins/:id` - Delete check-in (protected)

### Health
- `GET /api/health` - Health check endpoint

## üö¢ Deployment

### Deploying to Google Cloud VM

#### Prerequisites
1. Google Cloud account
2. GCP project created
3. VM instance created (Ubuntu 22.04 recommended)

#### Steps

1. **Create VM Instance**:
   - Go to Compute Engine > VM instances
   - Create instance with Ubuntu 22.04
   - Configure firewall to allow port 5000

2. **Install MongoDB on VM**:
   ```bash
   sudo apt-get update
   curl -fsSL https://www.mongodb.org/static/pgp/server-7.0.asc | sudo gpg -o /usr/share/keyrings/mongodb-server-7.0.gpg --dearmor
   echo "deb [ arch=amd64,arm64 signed-by=/usr/share/keyrings/mongodb-server-7.0.gpg ] https://repo.mongodb.org/apt/ubuntu jammy/mongodb-org/7.0 multiverse" | sudo tee /etc/apt/sources.list.d/mongodb-org-7.0.list
   sudo apt-get update
   sudo apt-get install -y mongodb-org
   sudo systemctl start mongod
   sudo systemctl enable mongod
   ```

3. **Install Node.js on VM**:
   ```bash
   curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
   sudo apt-get install -y nodejs
   ```

4. **Clone and Setup Application**:
   ```bash
   git clone <your-repo-url>
   cd <project-directory>
   cd server && npm install && cd ..
   cd client && npm install && npm run build && cd ..
   ```

5. **Configure Environment Variables**:
   Create `.env` file in project root:
   ```env
   PORT=5000
   NODE_ENV=production
   MONGODB_URI=mongodb://127.0.0.1:27017/anime-music-garden
   JWT_SECRET=your-secret-key
   CLIENT_URL=http://YOUR_VM_IP:5000
   ```

6. **Setup systemd Service**:
   Create `/etc/systemd/system/anime-music-garden.service`:
   ```ini
   [Unit]
   Description=Anime Music Garden Server
   
   [Service]
   ExecStart=/usr/bin/node /path/to/project/server/server.js
   WorkingDirectory=/path/to/project
   Restart=always
   RestartSec=10
   Environment=NODE_ENV=production
   Environment=PORT=5000
   Environment=MONGODB_URI="mongodb://127.0.0.1:27017/anime-music-garden"
   Environment=JWT_SECRET="your-secret-key"
   Environment=CLIENT_URL="http://YOUR_VM_IP:5000"
   
   [Install]
   WantedBy=multi-user.target
   ```

7. **Start Service**:
   ```bash
   sudo systemctl daemon-reload
   sudo systemctl enable anime-music-garden.service
   sudo systemctl start anime-music-garden.service
   ```

## üîê Security Notes

- **JWT Secret**: Always use a strong, random secret in production
- **JWT Refresh Tokens**: Access tokens expire in 15 minutes, refresh tokens in 30 days
- **Auto-login**: Refresh tokens enable automatic re-authentication on page reload
- **Role-based Access**: Admin routes are protected with role-based authorization
- **CORS**: Configure CORS to only allow your frontend domain
- **Password Hashing**: Passwords are hashed using bcrypt
- **Input Validation**: All inputs are validated using express-validator
- **MongoDB Change Streams**: Real-time updates via database change listeners

## üìù Usage Instructions

### For Graders

1. **Access the Application**:
   - Visit the deployment URL provided
   - Or run locally following the "Getting Started" section

2. **Create Your Own Account**:
   - Click "Register"
   - Fill in username and password
   - You'll be automatically logged in after registration

4. **Features to Test**:
   - **Dashboard**: View statistics and recent check-ins
   - **Garden**: Visualize your check-ins as flowers (click flowers for details)
   - **New Check-in**: Add anime episodes or music
   - **Profile**: View detailed statistics
   - **Real-time Updates**: Open garden in two tabs, add a check-in in one, see it appear in the other

5. **API Testing**:
   - Import `server/test-resources/AnimeMusicGarden.pm_collection.json` into Postman
   - Run the "Register" request first to get auth token
   - Test other endpoints

## üé® Features Implemented

### Basic Criteria ‚úÖ
- ‚úÖ Authentication (JWT-based)
- ‚úÖ User-specific CRUD functionality
- ‚úÖ Protected routes using JWTs
- ‚úÖ Error handling with fall-through handlers
- ‚úÖ Test coverage (Jest + Postman collection)
- ‚úÖ REST architecture
- ‚úÖ Clean, componentized API access on client

### Challenge Criteria (Medium) ‚úÖ
- ‚úÖ **Sockets**: Real-time garden updates using Socket.io
- ‚úÖ **MongoDB Change Listeners**: Change streams for automatic real-time updates
- ‚úÖ **Server-side 3rd Party API**: AniList API integration for anime search and details

### Challenge Criteria (High) ‚úÖ
- ‚úÖ **JWT Refresh Tokens**: Access and refresh token system with auto-login
- ‚úÖ **Role-based Authorization**: Admin and user roles with protected admin routes

## üêõ Troubleshooting

### MongoDB Connection Issues
- Ensure MongoDB is running locally: `sudo systemctl status mongod`
- Check `MONGODB_URI` in `.env` (should be `mongodb://127.0.0.1:27017/anime-music-garden`)
- Verify MongoDB service is enabled: `sudo systemctl enable mongod`

### Port Already in Use
- Change `PORT` in `.env`
- Or kill the process using the port

### CORS Errors
- Ensure `CLIENT_URL` in `.env` matches your frontend URL
- Check that backend CORS configuration is correct

### Socket.io Connection Issues
- Ensure backend is running
- Check that Socket.io server URL matches backend URL
- Verify CORS settings for Socket.io

## üìÑ License

MIT License - see LICENSE file for details

## üë§ Author

Created for SI679 Final Project - Fall 2025

## üôè Acknowledgments

- React team for the amazing framework
- Express.js for the robust backend framework
- MongoDB for the flexible database
- Socket.io for real-time capabilities
- Cursor AI and ChatGPT for providing inspirations and help during coding and debugging
